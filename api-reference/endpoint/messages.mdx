---
title: 'Mensagens'
description: 'Envie mensagens e consulte o status via Arara'
---

# Mensagens

A API de Mensagens permite que você envie e gerencie comunicações via WhatsApp de duas formas:

1. **Mensagens de Template**: Use templates pré-aprovados para iniciar conversas
2. **Mensagens de Texto Livre (Sessão)**: Responda mensagens recebidas dentro da janela de 24h

Além do envio, você pode consultar o status detalhado de qualquer mensagem usando o seu identificador público (`ara_msg_...`).

## Endpoint

`POST /api/v1/messages`

## Autenticação

Este endpoint requer autenticação. Inclua sua chave de API no cabeçalho `Authorization`:

```bash
Authorization: Bearer ara_sk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

## Corpo da Requisição

O corpo da requisição deve ser um objeto JSON. Você deve enviar **ou** `templateName` **ou** `body`, mas não ambos:

| Campo | Tipo | Obrigatório | Descrição |
|-------|------|-------------|-----------|
| `receiver` | string | Sim | Número do destinatário no formato `whatsapp:+5583991768778` |
| `templateName` | string | Condicional* | Nome do template que foi criado no dashboard (obrigatório para mensagens de template) |
| `variables` | array | Não | Lista de variáveis para preencher o template (padrão: `[]`) |
| `body` | string | Condicional* | Texto da mensagem (obrigatório para mensagens de sessão/inbound) |

\* Você deve enviar **ou** `templateName` **ou** `body`, mas não ambos.

### Formato do Número

O número do destinatário deve estar no formato:
- Prefixo: `whatsapp:+`
- Código do país: `55` (Brasil)
- DDD: `83`
- Número: `991768778`
- **Formato completo**: `whatsapp:+5583991768778`

<Info>
  O formato do número é importante! Sempre use o prefixo `whatsapp:+` seguido do código do país e o número completo sem espaços ou caracteres especiais.
</Info>

<Warning>
  **Importante**: O número de celular precisa ser cadastrado previamente pela equipe de suporte da Arara, junto com a documentação da empresa. Entre em contato com suporte@ararahq.com para solicitar o cadastro do número antes de começar a enviar mensagens.
</Warning>

## Modos de Envio

### 1. Mensagem de Template

Use este modo para **iniciar uma conversa** com um cliente. Templates são mensagens pré-aprovadas pelo WhatsApp que permitem iniciar conversas fora da janela de 24h.

**Campos obrigatórios:**
- `receiver`: Número do destinatário
- `templateName`: Nome do template criado no dashboard

**Campos opcionais:**
- `variables`: Array de variáveis para preencher o template

### 2. Mensagem de Texto Livre (Sessão/Inbound)

Use este modo para **responder mensagens recebidas** dentro da janela de 24h. Este é o mesmo endpoint usado para enviar templates, mas em vez de enviar `templateName`, você envia `body` com o texto da mensagem.

**Campos obrigatórios:**
- `receiver`: Número do destinatário
- `body`: Texto da mensagem

<Warning>
  **Importante**: Mensagens de texto livre só funcionam dentro da janela de 24h após o cliente ter iniciado uma conversa. Para iniciar uma conversa, você deve primeiro enviar um template.
</Warning>

## Exemplos de Requisição

### Enviar Template (sem variáveis)

```bash curl
curl -X POST https://api.ararahq.com/api/v1/messages \
  -H "Authorization: Bearer ara_sk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" \
  -H "Content-Type: application/json" \
  -d '{
    "receiver": "whatsapp:+5583991768778",
    "templateName": "template_teste_inicio_conversa",
    "variables": []
  }'
```

### Enviar Template (com variáveis)

Se seu template possui variáveis (como `{{1}}`, `{{2}}`, etc), você pode preenchê-las passando os valores no array `variables`:

```bash curl
curl -X POST https://api.ararahq.com/api/v1/messages \
  -H "Authorization: Bearer ara_sk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" \
  -H "Content-Type: application/json" \
  -d '{
    "receiver": "whatsapp:+5583991768778",
    "templateName": "template_teste_inicio_conversa",
    "variables": ["João", "R$ 100,00"]
  }'
```

### Enviar Mensagem de Texto Livre (Responder Inbound)

Para responder uma mensagem recebida, use o mesmo endpoint mas envie `body` em vez de `templateName`:

```bash curl
curl -X POST https://api.ararahq.com/api/v1/messages \
  -H "Authorization: Bearer ara_sk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" \
  -H "Content-Type: application/json" \
  -d '{
    "receiver": "whatsapp:+5583991768778",
    "body": "Olá! Como posso ajudar você hoje?"
  }'
```

<Warning>
  **Importante**: O template deve ter sido criado previamente no dashboard da Arara. Você não pode enviar mensagens usando templates que não existem na sua conta.
</Warning>

## Resposta de Sucesso

Quando a mensagem é aceita para processamento, você receberá uma resposta `202 Accepted` ou `200 OK`:

### Resposta para Template

```json
{
  "id": "ara_msg_k9Bf2XqP",
  "receiver": "whatsapp:+5583991768778",
  "templateName": "template_teste_inicio_conversa",
  "status": "PENDING",
  "messageType": "TEMPLATE",
  "createdAt": "2024-01-15T10:30:00Z"
}
```

### Resposta para Mensagem de Texto Livre

```json
{
  "id": "ara_msg_z7Lp4YwR",
  "receiver": "whatsapp:+5583991768778",
  "body": "Olá! Como posso ajudar você hoje?",
  "status": "SENT_TO_PROVIDER",
  "messageType": "SESSION",
  "createdAt": "2024-01-15T10:30:00Z"
}
```

### Campos da Resposta

| Campo | Tipo | Descrição |
|-------|------|-----------|
| `id` | string | **ID Arara** (Ex: `ara_msg_...`). Use este identificador para consultas e suporte. |
| `receiver` | string | Número do destinatário |
| `templateName` | string | Nome do template usado (apenas para mensagens de template) |
| `body` | string | Texto da mensagem (apenas para mensagens de sessão) |
| `status` | string | Status atual da mensagem (`PENDING`, `SENT_TO_PROVIDER`, `PROCESSING`, `DELIVERED`, `FAILED`) |
| `messageType` | string | Tipo da mensagem (`TEMPLATE` ou `SESSION`) |
| `createdAt` | string (ISO 8601) | Data e hora de criação da mensagem |

## Consultar Mensagem

Você pode consultar o status e os detalhes de uma mensagem enviada usando o seu `internalId`.

### Endpoint

`GET /api/v1/messages/{internalId}`

### Exemplo de Requisição

```bash curl
curl -X GET https://api.ararahq.com/api/v1/messages/ara_msg_k9Bf2XqP \
  -H "Authorization: Bearer ara_sk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
```

### Resposta de Sucesso

```json
{
  "id": "ara_msg_k9Bf2XqP",
  "status": "DELIVERED",
  "mode": "LIVE",
  "sender": "whatsapp:+5511999999999",
  "receiver": "whatsapp:+5516988888888",
  "body": "[OPORTUNIDADE] Evento: BAILE MEDICINA..."
}
```

## Códigos de Erro

### 400 Bad Request

A requisição está malformada ou faltam campos obrigatórios:

```json
{
  "error": "Bad Request",
  "message": "receiver is required"
}
```

### 401 Unauthorized

A chave de API é inválida ou não foi fornecida:

```json
{
  "error": "Unauthorized",
  "message": "Invalid or missing API key"
}
```

### 404 Not Found

O template especificado não existe ou não pertence à sua conta:

```json
{
  "error": "Not Found",
  "message": "Template 'template_teste_inicio_conversa' not found"
}
```

### 422 Unprocessable Entity

O número do destinatário está em formato inválido, o template não está aprovado, ou a janela de 24h está fechada:

```json
{
  "error": "Unprocessable Entity",
  "message": "Invalid receiver format. Expected format: whatsapp:+5583991768778"
}
```

Para mensagens de sessão, você pode receber:

```json
{
  "error": "Unprocessable Entity",
  "message": "Nenhuma conversa iniciada com este número. Para iniciar, envie um Template primeiro."
}
```

ou

```json
{
  "error": "Unprocessable Entity",
  "message": "Janela de 24h fechada (Última interação: 25h atrás). Envie um Template para reabrir a conversa."
}
```

## Exemplos em Diferentes Linguagens

<CodeGroup>
```bash cURL
curl -X POST https://api.ararahq.com/api/v1/messages \
  -H "Authorization: Bearer ara_sk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" \
  -H "Content-Type: application/json" \
  -d '{
    "receiver": "whatsapp:+5583991768778",
    "templateName": "template_teste_inicio_conversa",
    "variables": []
  }'
```

```python Python
import requests

url = "https://api.ararahq.com/api/v1/messages"
headers = {
    "Authorization": "Bearer ara_sk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
    "Content-Type": "application/json"
}
payload = {
    "receiver": "whatsapp:+5583991768778",
    "templateName": "template_teste_inicio_conversa",
    "variables": []
}

response = requests.post(url, json=payload, headers=headers)
print(response.json())
```

```javascript JavaScript
const fetch = require('node-fetch');

const url = 'https://api.ararahq.com/api/v1/messages';
const headers = {
  'Authorization': 'Bearer ara_sk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx',
  'Content-Type': 'application/json'
};
const body = {
  receiver: 'whatsapp:+5583991768778',
  templateName: 'template_teste_inicio_conversa',
  variables: []
};

fetch(url, {
  method: 'POST',
  headers: headers,
  body: JSON.stringify(body)
})
  .then(res => res.json())
  .then(data => console.log(data));
```

```typescript TypeScript
const url = 'https://api.ararahq.com/api/v1/messages';
const headers = {
  'Authorization': 'Bearer ara_sk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx',
  'Content-Type': 'application/json'
};
const body = {
  receiver: 'whatsapp:+5583991768778',
  templateName: 'template_teste_inicio_conversa',
  variables: []
};

const response = await fetch(url, {
  method: 'POST',
  headers: headers,
  body: JSON.stringify(body)
});

const data = await response.json();
console.log(data);
```

```java Java
import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;
import java.net.URI;
import java.time.Duration;
import com.fasterxml.jackson.databind.ObjectMapper;

HttpClient client = HttpClient.newBuilder()
    .connectTimeout(Duration.ofSeconds(10))
    .build();

ObjectMapper mapper = new ObjectMapper();
String jsonBody = mapper.writeValueAsString(Map.of(
    "receiver", "whatsapp:+5583991768778",
    "templateName", "template_teste_inicio_conversa",
    "variables", List.of()
));

HttpRequest request = HttpRequest.newBuilder()
    .uri(URI.create("https://api.ararahq.com/api/v1/messages"))
    .header("Authorization", "Bearer ara_sk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx")
    .header("Content-Type", "application/json")
    .POST(HttpRequest.BodyPublishers.ofString(jsonBody))
    .build();

HttpResponse<String> response = client.send(request, 
    HttpResponse.BodyHandlers.ofString());
System.out.println(response.body());
```

```kotlin Kotlin
import kotlinx.serialization.Serializable
import kotlinx.serialization.encodeToString
import kotlinx.serialization.json.Json
import java.net.http.HttpClient
import java.net.http.HttpRequest
import java.net.http.HttpResponse
import java.net.URI
import java.time.Duration

@Serializable
data class MessageRequest(
    val receiver: String,
    val templateName: String,
    val variables: List<String> = emptyList()
)

val client = HttpClient.newBuilder()
    .connectTimeout(Duration.ofSeconds(10))
    .build()

val requestBody = MessageRequest(
    receiver = "whatsapp:+5583991768778",
    templateName = "template_teste_inicio_conversa",
    variables = emptyList()
)

val jsonBody = Json.encodeToString(requestBody)

val request = HttpRequest.newBuilder()
    .uri(URI.create("https://api.ararahq.com/api/v1/messages"))
    .header("Authorization", "Bearer ara_sk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx")
    .header("Content-Type", "application/json")
    .POST(HttpRequest.BodyPublishers.ofString(jsonBody))
    .build()

val response = client.send(request, HttpResponse.BodyHandlers.ofString())
println(response.body())
```
</CodeGroup>

## Próximos Passos

<CardGroup cols={2}>
  <Card title="Criar Templates" icon="bezier-curve" href="/business-rules/template-management">
    Aprenda a criar templates no dashboard
  </Card>
  <Card title="Webhooks" icon="webhook" href="/api-reference/endpoint/webhook">
    Configure webhooks para receber notificações
  </Card>
</CardGroup>

